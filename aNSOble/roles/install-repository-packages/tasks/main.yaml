- name: Cloning the repository to /tmp directory
  git:
    repo: "https://{{GITUser}}:{{GITKeypass}}@{{RepositoryURL}}"
    dest: /tmp/repo
    force: yes

- name: Copy NSO service packages to /var/opt/ncs/packages
  copy:
    src: /tmp/repo/{{ ServicePackagesPath }}/{{ item.name }}
    dest: /var/opt/ncs/packages
  become: true
  loop: "{{ Packages }}"

- name: Compiling the packages 
  shell: make clean all -C {{ item.name }}/src/
  args:
    chdir: /var/opt/ncs/packages/
    warn: false
  become: true
  loop: "{{ Packages }}"

- name: Reloading NSO packages
  shell: |
    source /opt/ncs/current/ncsrc
    echo 'packages reload' | ncs_cli -C
  environment:
    PATH: /opt/ncs/current/bin:{{ ansible_env.PATH }}  